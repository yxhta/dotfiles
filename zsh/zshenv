# ============================================================================
# ZSH Environment Configuration
# ============================================================================
# This file is sourced for all shell instances (login, non-login, interactive, non-interactive)

# ============================================================================
# XDG Base Directory Specification
# ============================================================================

export XDG_CONFIG_HOME=~/.config
export XDG_DATA_HOME=~/.local/share
export XDG_CACHE_HOME=~/.cache
export XDG_STATE_HOME=~/.local/state

# ============================================================================
# Development Environment
# ============================================================================

# Go development
export GOPATH=$HOME/go

# Rust development
export CARGO_HOME=$HOME/.cargo

# Android development
export ANDROID_SDK_ROOT="$HOME/Library/Android/sdk"

# ============================================================================
# PATH Configuration
# ============================================================================

# Ensure unique PATH entries
typeset -U path

# Build PATH with development tools in priority order (user → language → tooling → system)
path=(
  # User scripts and shims
  $HOME/bin
  $HOME/.claude/local
  $HOME/.antigravity/antigravity/bin

  # Package managers
  ${PNPM_HOME:-$HOME/Library/pnpm}
  $HOME/.asdf/bin
  $HOME/.local/share/mise/bin

  # Language-specific tools
  $GOPATH/bin                                    # Go binaries
  $CARGO_HOME/bin                               # Rust/Cargo binaries
  $HOME/.pub-cache/bin                          # Dart/Flutter pub cache
  
  # Flutter SDK
  $HOME/development/flutter/bin
  # export PATH="$PATH:$ANDROID_SDK_ROOT/platform-tools"
  $ANDROID_SDK_ROOT/platform-tools

  # Claude Code
  $HOME/.claude/local
  
  # System tools
  /usr/local/bin
  /usr/local/opt/make/libexec/gnubin           # GNU make
  /usr/local/opt/llvm/bin                      # LLVM tools
  
  # Applications
  /Applications/WezTerm.app/Contents/MacOS      # WezTerm terminal

  # Google Cloud SDK
  $HOME/google-cloud-sdk/bin

  # Homebrew (prefer /opt on Apple Silicon; fall back to /usr/local)
  ${HOMEBREW_PREFIX:-/opt/homebrew}/bin
  ${HOMEBREW_PREFIX:-/opt/homebrew}/sbin
  /usr/local/bin
  /usr/local/sbin

  # Existing PATH
  $path
)

export PATH

# ============================================================================
# Tool Initialization
# ============================================================================

# Export PNPM_HOME explicitly for tools that expect it
export PNPM_HOME="${PNPM_HOME:-$HOME/Library/pnpm}"

# Google Cloud SDK PATH (kept in zshenv so non-interactive shells can find gcloud)
if [ -f "$HOME/google-cloud-sdk/path.zsh.inc" ]; then
  . "$HOME/google-cloud-sdk/path.zsh.inc"
fi

# Load Cargo environment if available
if [ -f "$HOME/.cargo/env" ]; then
  . "$HOME/.cargo/env"
fi
